{"ast":null,"code":"import { combineReducers } from \"@reduxjs/toolkit\";\nimport createAsyncSlice from \"./helper/createAsyncSlice\";\nimport getLocalStorage from \"./helper/getLocalStorage\";\nimport { removePhotos } from \"./photos\";\nconst token = createAsyncSlice({\n  name: \"token\",\n  initialState: {\n    data: {\n      token: getLocalStorage(\"token\", null)\n    }\n  },\n  reducers: {\n    removeToken(state) {\n      state.data = null;\n    },\n    fetchSuccess: {\n      reducer(state, action) {\n        state.loading = false;\n        state.data = action.payload;\n        state.error = null;\n      },\n      prepare(payload) {\n        return {\n          payload,\n          meta: {\n            localStorage: {\n              key: \"token\",\n              value: payload.token\n            }\n          }\n        };\n      }\n    }\n  },\n  fetchConfig: user => ({\n    url: \"https://dogsapi.origamid.dev/json/jwt-auth/v1/token\",\n    options: {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(user)\n    }\n  })\n});\nconst user = createAsyncSlice({\n  name: \"user\",\n  reducers: {\n    removeUser(state) {\n      state.data = null;\n    }\n  },\n  fetchConfig: token => ({\n    url: \"https://dogsapi.origamid.dev/json/api/user\",\n    options: {\n      method: \"GET\",\n      headers: {\n        Authorization: \"Bearer \" + token\n      }\n    }\n  })\n});\nconst reducer = combineReducers({\n  token: token.reducer,\n  user: user.reducer\n});\nexport default reducer;\nexport const fetchToken = token.asyncAction;\nexport const fetchUser = user.asyncAction;\nconst {\n  removeToken\n} = token.actions;\nconst {\n  removeUser\n} = user.actions;\nexport const login = user => async dispatch => {\n  try {\n    const {\n      payload\n    } = await dispatch(fetchToken(user));\n    if (payload.token !== undefined) await dispatch(fetchUser(payload.token));\n  } catch (error) {}\n};\nexport const autoLogin = () => async (dispatch, getState) => {\n  const state = getState();\n  const {\n    token\n  } = state.login.token.data;\n  if (token) await dispatch(fetchUser(token));\n};\nexport const userLogout = () => dispatch => {\n  dispatch(removeUser());\n  dispatch(removeToken());\n  dispatch(removePhotos());\n  window.localStorage.removeItem(\"token\");\n};","map":{"version":3,"names":["combineReducers","createAsyncSlice","getLocalStorage","removePhotos","token","name","initialState","data","reducers","removeToken","state","fetchSuccess","reducer","action","loading","payload","error","prepare","meta","localStorage","key","value","fetchConfig","user","url","options","method","headers","body","JSON","stringify","removeUser","Authorization","fetchToken","asyncAction","fetchUser","actions","login","dispatch","undefined","autoLogin","getState","userLogout","window","removeItem"],"sources":["/home/samanta/Documentos/mini-dogs/src/store/login.js"],"sourcesContent":["import { combineReducers } from \"@reduxjs/toolkit\";\nimport createAsyncSlice from \"./helper/createAsyncSlice\";\nimport getLocalStorage from \"./helper/getLocalStorage\";\nimport { removePhotos } from \"./photos\";\n\nconst token = createAsyncSlice({\n  name: \"token\",\n  initialState: {\n    data: {\n      token: getLocalStorage(\"token\", null),\n    },\n  },\n  reducers: {\n    removeToken(state) {\n      state.data = null;\n    },\n    fetchSuccess: {\n      reducer(state, action) {\n        state.loading = false;\n        state.data = action.payload;\n        state.error = null;\n      },\n      prepare(payload) {\n        return {\n          payload,\n          meta: {\n            localStorage: {\n              key: \"token\",\n              value: payload.token,\n            },\n          },\n        };\n      },\n    },\n  },\n  fetchConfig: (user) => ({\n    url: \"https://dogsapi.origamid.dev/json/jwt-auth/v1/token\",\n    options: {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(user),\n    },\n  }),\n});\n\nconst user = createAsyncSlice({\n  name: \"user\",\n  reducers: {\n    removeUser(state) {\n      state.data = null;\n    },\n  },\n  fetchConfig: (token) => ({\n    url: \"https://dogsapi.origamid.dev/json/api/user\",\n    options: {\n      method: \"GET\",\n      headers: {\n        Authorization: \"Bearer \" + token,\n      },\n    },\n  }),\n});\n\nconst reducer = combineReducers({ token: token.reducer, user: user.reducer });\n\nexport default reducer;\n\nexport const fetchToken = token.asyncAction;\nexport const fetchUser = user.asyncAction;\n\nconst { removeToken } = token.actions;\nconst { removeUser } = user.actions;\n\nexport const login = (user) => async (dispatch) => {\n  try {\n    const { payload } = await dispatch(fetchToken(user));\n    if (payload.token !== undefined) await dispatch(fetchUser(payload.token));\n  } catch (error) {}\n};\n\nexport const autoLogin = () => async (dispatch, getState) => {\n  const state = getState();\n  const { token } = state.login.token.data;\n  if (token) await dispatch(fetchUser(token));\n};\n\nexport const userLogout = () => (dispatch) => {\n  dispatch(removeUser());\n  dispatch(removeToken());\n  dispatch(removePhotos());\n  window.localStorage.removeItem(\"token\");\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}